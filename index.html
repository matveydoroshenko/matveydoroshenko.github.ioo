<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>App</title>
  <script>
    function setThemeClass() {
      document.documentElement.className = Telegram.WebApp.colorScheme;
    }
    Telegram.WebView.onEvent('theme_changed', setThemeClass);
    setThemeClass();
  </script>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<section class="items-block">
  <div class="cafe-item js-item" data-item-id="1" data-item-price="250000">
    <div class="cafe-item-counter js-item-counter">1</div>
    <div class="cafe-item-label">
      <span class="cafe-item-title">ISE</span>
      <span class="cafe-item-price">$250</span>
    </div>
    <div class="cafe-item-buttons">
      <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
        <span class="ripple-mask"><span class="ripple"></span></span>
      </button>
      <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
        <span class="button-item-label">Add</span>
        <span class="ripple-mask"><span class="ripple"></span></span>
      </button>
    </div>
  </div>  <div class="cafe-item js-item" data-item-id="2" data-item-price="750000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">FMC/FMCv</span>
    <span class="cafe-item-price">$750</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="3" data-item-price="125000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">Firepower 1k</span>
    <span class="cafe-item-price">$125</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="4" data-item-price="175000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">Firepower&nbsp</span>
    <span class="cafe-item-title">2k</span>
    <span class="cafe-item-price">$175</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="5" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">Firepower&nbsp</span>
    <span class="cafe-item-title">4k</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="6" data-item-price="50000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASAv5</span>
    <span class="cafe-item-price">$50</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="7" data-item-price="100000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASAv10</span>
    <span class="cafe-item-price">$100</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="8" data-item-price="175000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASAv30</span>
    <span class="cafe-item-price">$175</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="9" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASAv50</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="10" data-item-price="300000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASAv100</span>
    <span class="cafe-item-price">$300</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="11" data-item-price="125000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">Catalyst</span>
    <span class="cafe-item-price">$125</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="12" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">WLC9800</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="13" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">WLC9800</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="14" data-item-price="125000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ISR&nbsp</span>
    <span class="cafe-item-title">43/44/45&nbsp</span>
    <span class="cafe-item-title">v17.3</span>
    <span class="cafe-item-price">$125</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="15" data-item-price="175000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ASR920/1k/9k</span>
    <span class="cafe-item-price">$175</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="16" data-item-price="175000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">CSR1000v</span>
    <span class="cafe-item-price">$175</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="17" data-item-price="650000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">CUCM/Expressway</span>
    <span class="cafe-item-price">$650</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="18" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">c8000v&nbsp</span>
    <span class="cafe-item-title">v17.3+</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="19" data-item-price="1200000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ESAv+XML</span>
    <span class="cafe-item-price">$1200</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="20" data-item-price="175000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ISR&nbsp</span>
    <span class="cafe-item-title">43/44/45&nbsp</span>
    <span class="cafe-item-title">v17.3+</span>
    <span class="cafe-item-price">$175</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="20" data-item-price="250000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">&nbsp&nbspASR920/1k/9k&nbsp</span>
    <span class="cafe-item-title">v17.3+</span>
    <span class="cafe-item-price">$250</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div>  <div class="cafe-item js-item" data-item-id="21" data-item-price="200000">
  <div class="cafe-item-counter js-item-counter">1</div>
  <div class="cafe-item-label">
    <span class="cafe-item-title">ESAv</span>
    <span class="cafe-item-price">$200</span>
  </div>
  <div class="cafe-item-buttons">
    <button class="cafe-item-decr-button js-item-decr-btn button-item ripple-handler">
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
    <button class="cafe-item-incr-button js-item-incr-btn button-item ripple-handler">
      <span class="button-item-label">Add</span>
      <span class="ripple-mask"><span class="ripple"></span></span>
    </button>
  </div>
</div><div class="cafe-item-shadow"></div><div class="cafe-item-shadow"></div><div class="cafe-item-shadow"></div><div class="cafe-item-shadow"></div>
</section>
</body>
<script type="text/javascript">
  let tg = window.Telegram.WebApp;
  tg.MainButton.show()
  Telegram.WebApp.onEvent('mainButtonClicked', function(){
    tg.sendData("some string that we need to send");
  });

  var Cafe = {
    canPay: true,
    modeOrder: true,
    totalPrice: 29,

    init: function(options) {
      Telegram.WebApp.ready();
      Cafe.apiUrl = options.apiUrl;
      Cafe.userId = options.userId;
      Cafe.userHash = options.userHash;
      Cafe.initLotties();
      var userId = Telegram.WebApp.initData && Telegram.WebApp.initData.user && Telegram.WebApp.initData.user.id || Cafe.userId;
      if(options.debug) {
        var userId = 2349000000;
      }
      $('body').show();
      if (!userId) {
        Cafe.isClosed = true;
        $('body').addClass('closed');
        Cafe.showStatus('Cafe is temporarily closed');
        return;
      }
      $('.js-item-lottie').on('click', Cafe.eLottieClicked);
      $('.js-item-incr-btn').on('click', Cafe.eIncrClicked);
      $('.js-item-decr-btn').on('click', Cafe.eDecrClicked);
      $('.js-order-edit').on('click', Cafe.eEditClicked);
      $('.js-status').on('click', Cafe.eStatusClicked);
      $('.js-order-comment-field').each(function() {
        autosize(this);
      });
      Telegram.WebApp.MainButton.setParams({
        text_color: '#fff'
      }).onClick(Cafe.mainBtnClicked);
      initRipple();
    },
    initLotties: function() {
      $('.js-item-lottie').each(function() {
        RLottie.init(this, {
          maxDeviceRatio: 2,
          cachingModulo: 3,
          noAutoPlay: true
        });
      });
    },
    eLottieClicked: function(e) {
      if (Cafe.isClosed) {
        return false;
      }
      RLottie.playOnce(this);
    },
    eIncrClicked: function(e) {
      e.preventDefault();
      var itemEl = $(this).parents('.js-item');
      Cafe.incrClicked(itemEl, 1);
    },
    eDecrClicked: function(e) {
      e.preventDefault();
      var itemEl = $(this).parents('.js-item');
      Cafe.incrClicked(itemEl, -1);
    },
    eEditClicked: function(e) {
      e.preventDefault();
      Cafe.toggleMode(false);
    },
    getOrderItem: function(itemEl) {
      var id = itemEl.data('item-id');
      return $('.js-order-item').filter(function() {
        return ($(this).data('item-id') == id);
      });
    },
    updateItem: function(itemEl, delta) {
      var price = +itemEl.data('item-price');
      var count = +itemEl.data('item-count') || 0;
      var counterEl = $('.js-item-counter', itemEl);
      counterEl.text(count ? count : 1);
      var isSelected = itemEl.hasClass('selected');
      if (!isSelected && count > 0) {
        $('.js-item-lottie', itemEl).each(function() {
          RLottie.playOnce(this);
        });
      }
      var anim_name = isSelected ? (delta > 0 ? 'badge-incr' : (count > 0 ? 'badge-decr' : 'badge-hide')) : 'badge-show';
      var cur_anim_name = counterEl.css('animation-name');
      if ((anim_name == 'badge-incr' || anim_name == 'badge-decr') && anim_name == cur_anim_name) {
        anim_name += '2';
      }
      counterEl.css('animation-name', anim_name);
      itemEl.toggleClass('selected', count > 0);

      var orderItemEl = Cafe.getOrderItem(itemEl);
      var orderCounterEl = $('.js-order-item-counter', orderItemEl);
      orderCounterEl.text(count ? count : 1);
      orderItemEl.toggleClass('selected', count > 0);
      var orderPriceEl = $('.js-order-item-price', orderItemEl);
      var item_price = count * price;
      orderPriceEl.text(Cafe.formatPrice(item_price));

      Cafe.updateTotalPrice();
    },
    incrClicked: function(itemEl, delta) {
      if (Cafe.isLoading || Cafe.isClosed) {
        return false;
      }
      var count = +itemEl.data('item-count') || 0;
      count += delta;
      if (count < 0) {
        count = 0;
      }
      itemEl.data('item-count', count);
      Cafe.updateItem(itemEl, delta);
    },
    formatPrice: function(price) {
      return '$' + Cafe.formatNumber(price / 1000, 2, '.', ',');
    },
    formatNumber: function(number, decimals, decPoint, thousandsSep) {
      number = (number + '').replace(/[^0-9+\-Ee.]/g, '')
      var n = !isFinite(+number) ? 0 : +number
      var prec = !isFinite(+decimals) ? 0 : Math.abs(decimals)
      var sep = (typeof thousandsSep === 'undefined') ? ',' : thousandsSep
      var dec = (typeof decPoint === 'undefined') ? '.' : decPoint
      var s = ''
      var toFixedFix = function (n, prec) {
        if (('' + n).indexOf('e') === -1) {
          return +(Math.round(n + 'e+' + prec) + 'e-' + prec)
        } else {
          var arr = ('' + n).split('e')
          var sig = ''
          if (+arr[1] + prec > 0) {
            sig = '+'
          }
          return (+(Math.round(+arr[0] + 'e' + sig + (+arr[1] + prec)) + 'e-' + prec)).toFixed(prec)
        }
      }
      s = (prec ? toFixedFix(n, prec).toString() : '' + Math.round(n)).split('.')
      if (s[0].length > 3) {
        s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep)
      }
      if ((s[1] || '').length < prec) {
        s[1] = s[1] || ''
        s[1] += new Array(prec - s[1].length + 1).join('0')
      }
      return s.join(dec)
    },
    updateMainButton: function() {
      var mainButton = Telegram.WebApp.MainButton;
      if (Cafe.modeOrder) {
        if (Cafe.isLoading) {
          mainButton.setParams({
            is_visible: true,
            color: '#65c36d'
          }).showProgress();
        } else {
          mainButton.setParams({
            is_visible: !!Cafe.canPay,
            text: 'PAY ' + Cafe.formatPrice(Cafe.totalPrice),
            color: '#31b545'
          }).hideProgress();
        }
      } else {
        mainButton.setParams({
          is_visible: !!Cafe.canPay,
          text: 'VIEW ORDER',
          color: '#31b545'
        }).hideProgress();
      }
    },
    updateTotalPrice: function() {
      var total_price = 0;
      $('.js-item').each(function() {
        var itemEl = $(this)
        var price = +itemEl.data('item-price');
        var count = +itemEl.data('item-count') || 0;
        total_price += price * count;
      });
      Cafe.canPay = total_price > 0;
      Cafe.totalPrice = total_price;
      Cafe.updateMainButton();
    },
    getOrderData: function() {
      var order_data = [];
      $('.js-item').each(function() {
        var itemEl = $(this)
        var id    = itemEl.data('item-id');
        var count = +itemEl.data('item-count') || 0;
        if (count > 0) {
          order_data.push({id: id, count: count});
        }
      });
      return JSON.stringify(order_data);
    },
    toggleMode: function(mode_order) {
      Cafe.modeOrder = mode_order;
      var anim_duration, match;
      try {
        anim_duration = window.getComputedStyle(document.body).getPropertyValue('--page-animation-duration');
        if (match = /([\d\.]+)(ms|s)/.exec(anim_duration)) {
          anim_duration = +match[1];
          if (match[2] == 's') {
            anim_duration *= 1000;
          }
        } else {
          anim_duration = 400;
        }
      } catch (e) {
        anim_duration = 400;
      }
      if (mode_order) {
        var height = $('.cafe-items').height();
        $('.js-item-lottie').each(function() {
          RLottie.setVisible(this, false);
        });
        $('.cafe-order-overview').show();
        $('.cafe-items').css('maxHeight', height).redraw();
        $('body').addClass('order-mode');
        $('.js-order-comment-field').each(function() {
          autosize.update(this);
        });
        Telegram.WebApp.expand();
        setTimeout(function() {
          $('.js-item-lottie').each(function() {
            RLottie.setVisible(this, true);
          });
        }, anim_duration);
      } else {
        $('.js-item-lottie').each(function() {
          RLottie.setVisible(this, false);
        });
        $('body').removeClass('order-mode');
        setTimeout(function() {
          $('.cafe-items').css('maxHeight', '');
          $('.cafe-order-overview').hide();
          $('.js-item-lottie').each(function() {
            RLottie.setVisible(this, true);
          });
        }, anim_duration);
      }
      Cafe.updateMainButton();
    },
    toggleLoading: function(loading) {
      Cafe.isLoading = loading;
      Cafe.updateMainButton();
      $('body').toggleClass('loading', !!Cafe.isLoading);
      Cafe.updateTotalPrice();
    },
    mainBtnClicked: function() {
      if (!Cafe.canPay || Cafe.isLoading || Cafe.isClosed) {
        return false;
      }
      if (Cafe.modeOrder) {
        var comment = $('.js-order-comment-field').val();
        var params = {
          order_data: Cafe.getOrderData(),
          comment: comment
        };
        if (!Telegram.WebApp.initData ||
                !Telegram.WebApp.initData.user ||
                !Telegram.WebApp.initData.user.id) {
          params.user_id = Cafe.userId;
          params.user_hash = Cafe.userHash;
        }
        Cafe.toggleLoading(true);
        Cafe.apiRequest('makeOrder', params, function(result) {
          Cafe.toggleLoading(false);
          if (result.ok) {
            Telegram.WebApp.close();
          }
          if (result.error) {
            Cafe.showStatus(result.error);
          }
        });
      } else {
        Cafe.toggleMode(true);
      }
    },
    eStatusClicked: function() {
      Cafe.hideStatus();
    },
    showStatus: function(text) {
      clearTimeout(Cafe.statusTo);
      $('.js-status').text(text).addClass('shown');
      if (!Cafe.isClosed) {
        Cafe.statusTo = setTimeout(function(){ Cafe.hideStatus(); }, 2500);
      }
    },
    hideStatus: function() {
      clearTimeout(Cafe.statusTo);
      $('.js-status').removeClass('shown');
    },
  }
</script>
</html>
